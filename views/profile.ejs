<style>
  @import url("https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap");
  body {
    background: #f9f9f9;
  }
  @media (max-width: 767px) {
    body {
      height: calc(100vh - 56px);
      overflow-y: auto;
    }
  }
  @media (min-width: 768px) {
    .p-md-2 {
      padding: 2.5rem !important;
    }
  }
  .table > :not(caption) > * > * {
    padding: 1.5rem 1rem;
    background-color: var(--bs-table-bg);
    border-bottom-width: 1px;
    box-shadow: inset 0 0 0 9999px var(--bs-table-accent-bg);
  }

  .dropdown-menu {
    box-shadow: 0 1.5rem 4rem rgba(22, 28, 45, 0.12);
    padding: 1rem 1.5rem;
    min-width: 4rem;
    z-index: 10000000;
  }
  .dropdown-item {
    color: white;
  }
  .table-responsive {
    overflow-x: auto;
    min-width: auto;
  }

  .table-head {
    vertical-align: middle;
    text-align: center;
  }
  .table-row {
    vertical-align: middle;
    align-items: center;
  }

  .product-name {
    font-weight: 900;
    font-size: small;
    text-transform: uppercase;
  }
  .card {
    position: relative;
    display: flex;
    flex-direction: row;
    min-width: 22px;
    word-wrap: break-word;
    background-color: #fff;
    background-clip: border-box;
    border: 1px solid rgba(0, 0, 0, 0.125);
    margin-bottom: 4vh;
    border-radius: 1.5rem;
    .border-secondary,
    .border-secondary-active:active,
    .border-secondary-focus:focus,
    .border-secondary-hover:hover {
      border-color: #dedede !important;
    }
  }
  .shadow {
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1) !important;
  }
  .profile-tab-nav {
    border-right: 0.2px solid #d4d4d4;
  }

  .profile-tab-nav {
    min-width: 250px;
  }

  .tab-content {
    flex: 1;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .nav-pills a.nav-link {
    padding: 15px 20px;
    border-bottom: 1px solid #ddd;
    border-radius: 0;
    color: #333;
  }
  .nav-pills a.nav-link i {
    width: 20px;
  }

  .img-circle img {
    height: 100px;
    width: 100px;
    border-radius: 100%;
    border: 5px solid #fff;
  }
  .tabel-coloumn {
    vertical-align: middle;
  }
</style>
<style>
  .dropdown {
    position: relative;
    display: inline-block;
  }

  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 120px;
    box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
    z-index: 1;
  }

  .dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
  }

  .dropdown-content a:hover {
    background-color: #f1f1f1;
  }

  .show {
    display: block;
  }
</style>

<section class="py-3 my-3">
  <div class="container">
    <div class="bg-white shadow rounded-lg d-block d-sm-flex">
      <div class="profile-tab-nav border-right border-secondary">
        <div class="p-4">
          <div class="img-circle text-center mb-3">
            <img
              src="https://img.freepik.com/premium-vector/people-saving-money_24908-51569.jpg?w=740"
              alt="Image"
              class="shadow"
            />
          </div>
          <h4 class="text-center"><%= address.fname %> <%= address.lname %></h4>
        </div>
        <div
          class="nav flex-column nav-pills"
          id="v-pills-tab"
          role="tablist"
          aria-orientation="vertical"
        >
          <a
            class="nav-link active"
            id="account-tab"
            data-bs-toggle="pill"
            href="#account"
            role="tab"
            aria-controls="account"
            aria-selected="true"
          >
            <i class="fa fa-home text-center mr-1"></i>
            Account
          </a>
          <a
            class="nav-link"
            id="password-tab"
            data-bs-toggle="pill"
            href="#password"
            role="tab"
            aria-controls="password"
            aria-selected="false"
          >
            <i class="fa fa-key text-center mr-1"></i>
            Password
          </a>
          <a
            class="nav-link"
            id="security-tab"
            data-bs-toggle="pill"
            href="#security"
            role="tab"
            aria-controls="security"
            aria-selected="false"
          >
            <i class="fa fa-user text-center mr-1"></i>
            Security
          </a>
          <a
            class="nav-link"
            id="application-tab"
            data-bs-toggle="pill"
            href="#application"
            role="tab"
            aria-controls="application"
            aria-selected="false"
          >
            <i class="fa fa-tv text-center mr-1"></i>
            Shipping Address
          </a>
          <a
            class="nav-link"
            id="notification-tab"
            data-bs-toggle="pill"
            href="#notification"
            role="tab"
            aria-controls="notification"
            aria-selected="false"
          >
            <i class="fa fa-bell text-center mr-1"></i>
            View Orders
          </a>
          <a href="/logout" class="nav-link" id="notification-tab">
            <i class="fa fa-bell text-center mr-1"></i>
            Log Out
          </a>
        </div>
      </div>
      <div class="tab-content p-md-2" id="v-pills-tabContent">
        <div
          class="tab-pane fade show active"
          id="account"
          role="tabpanel"
          aria-labelledby="account-tab"
        >
          <h3 class="mb-4">Account Settings</h3>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="firstName" class="form-label">First Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="editFirstName"
                  value="<%= address.fname %>"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="lastName" class="form-label">Last Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="editLastName"
                  value="<%= address.lname %>"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input
                  type="text"
                  class="form-control"
                  id="editEmail"
                  value="<%= address.email %>"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="phoneNumber" class="form-label">Phone number</label>
                <input
                  type="text"
                  class="form-control"
                  id="editPhoneNumber"
                  value="<%= address.phoneNumber %>"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="company" class="form-label">Address</label>
                <input
                  type="text"
                  class="form-control"
                  id="editAddress"
                  value="<%= address.address %>"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="company" class="form-label">Country</label>
                <input
                  type="text"
                  class="form-control"
                  id="editCountry"
                  value="<%= address.country %>"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="company" class="form-label">State</label>
                <input
                  type="text"
                  class="form-control"
                  id="editState"
                  value="<%= address.state %>"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="company" class="form-label">Zip/Post</label>
                <input
                  type="text"
                  class="form-control"
                  id="editZipCode"
                  value="<%= address.zipcode %>"
                />
              </div>
            </div>
          </div>
          <div>
            <button
              id="submitAddressButton"
              data-address-id="<%= address._id %>"
              class="btn btn-primary"
            >
              Update
            </button>
            <button class="btn btn-success">Cancel</button>
          </div>
        </div>
        <div
          class="tab-pane fade"
          id="password"
          role="tabpanel"
          aria-labelledby="password-tab"
        >
          <h3 class="mb-4">Password Settings</h3>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="oldPassword" class="form-label">Old password</label>
                <input type="password" class="form-control" id="oldPassword" />
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="newPassword" class="form-label">New password</label>
                <input type="password" class="form-control" id="newPassword" />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="confirmPassword" class="form-label"
                  >Confirm new password</label
                >
                <input
                  type="password"
                  class="form-control"
                  id="confirmPassword"
                />
              </div>
            </div>
          </div>
          <div>
            <button class="btn btn-primary">Update</button>
            <button class="btn btn-light">Cancel</button>
          </div>
        </div>
        <div
          class="tab-pane fade"
          id="security"
          role="tabpanel"
          aria-labelledby="security-tab"
        >
          <h3 class="mb-4">Security Settings</h3>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="login" class="form-label">Login</label>
                <input type="text" class="form-control" id="login" />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="twoFactorAuth" class="form-label"
                  >Two-factor auth</label
                >
                <input type="text" class="form-control" id="twoFactorAuth" />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value=""
                    id="recovery"
                  />
                  <label class="form-check-label" for="recovery">
                    Recovery
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div>
            <button class="btn btn-primary">Update</button>
            <button class="btn btn-light">Cancel</button>
          </div>
        </div>
        <div
          class="tab-pane fade"
          id="application"
          role="tabpanel"
          aria-labelledby="application-tab"
        >
          <h3 class="mb-4">Shipping Address</h3>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <% for (let i = 0; i < allAddress.length; i++) { %>
                <div class="card">
                  <div class="card-body">
                    <h5 class="card-title">
                      <% if (i === 0) { %> Default Address <% } else { %>
                      Address <%= i %> <% } %>
                    </h5>
                    <p class="card-text">
                      <%= allAddress[i].fname %> <%= allAddress[i].lname %>,
                    </p>
                    <p class="card-text">
                      <%= allAddress[i].address %>, <%= allAddress[i].state %>,
                      <%= allAddress[i].country %>
                    </p>
                    <p class="card-text">
                      <%= allAddress[i].phoneNumber %>, <%=
                      allAddress[i].zipcode %>
                    </p>
                  </div>
                </div>
                <% } %>
                <div class="card">
                  <div class="card-body">
                    <h4 style="padding: 3rem; font-weight: bold">
                      <a href="">Add Address</a>
                    </h4>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div
          class="tab-pane fade"
          id="notification"
          role="tabpanel"
          aria-labelledby="notification-tab"
        >
          <h3 class="mb-4">ORDERS</h3>
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th class="table-head">No</th>
                  <th class="table-head">Order ID</th>
                  <th class="table-head">Date</th>
                  <th class="table-head">Items</th>
                  <th class="table-head">Total Price</th>
                  <th class="table-head">Status</th>
                  <th class="table-head">Actions</th>
                </tr>
              </thead>
              <tbody>
                <% allorders.forEach(function(order, index) { %>
                <tr>
                  <td class="table-row"><%= index + 1 %></td>
                  <td class="table-row">#<%= order.orderNumber %></td>
                  <td class="table-row"><%= order.date.toDateString() %></td>
                  <td class="table-row">
                    <% order.items.forEach(function(item) { %>
                    <div
                      class="item-info d-flex justify-content-between align-items-center"
                    >
                      <div class="item-details" style="max-width: 11rem">
                        <div class="product-name"><%= item.product.name %></div>
                        <div>
                          <%= item.quantity %> x
                          <span>$<%= item.product.price %></span>
                        </div>
                      </div>
                      <div style="padding: 0.3rem">
                        <img
                          src="<%= item.product.image %>"
                          alt="<%= item.product.name %>"
                          width="70px"
                          class="img-thumbnail"
                        />
                      </div>
                    </div>
                    <% }); %>
                  </td>
                  <td class="table-row">$<%= order.totalAmount %></td>
                  <td class="table-row"><%= order.status %></td>
                  <td class="table-row">
                    <div class="btn-group">
                      <a
                        href="#"
                        data-bs-toggle="collapse"
                        data-bs-target="#dropdown<%= order._id %>"
                      >
                        Details
                      </a>
                      <div
                        class="collapse dropdown-menu"
                        style="background-color: #0a1025"
                        id="dropdown<%= order._id %>"
                      >
                        <% if (order.status === 'processing' || order.status === 'shipped') { %>
                          <a
                            href="/order-details?id=<%= order._id %>"
                            class="dropdown-item"
                          >
                            View
                          </a>
                          <a
                            href="/cancel-order?id=<%= order._id %>"
                            class="dropdown-item"
                          >
                            Cancel order
                          </a>
                        <% } else if (order.status === 'delivered') { %>
                          <a class="dropdown-item" href="#">View</a>
                          <a
                            class="dropdown-item"
                            href="/return-order?id=<%= order._id %>"
                          >
                            Return
                          </a>
                        <% } else { %>
                          <a
                            href="/order-details?id=<%= order._id %>"
                            class="dropdown-item"
                          >
                            View
                          </a>
                        <% } %>
                      </div>
                    </div>
                  </td>
                  
                </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- UPADATE USER ADDRESS -->
<script>
  var addressId;
  function editAddress(id) {
    addressId = id;
    var emailInput = document.getElementById("editEmail");
    var firstNameInput = document.getElementById("editFirstName");
    var lastNameInput = document.getElementById("editLastName");
    var addressInput = document.getElementById("editAddress");
    var phoneNumberInput = document.getElementById("editPhoneNumber");
    var countryInput = document.getElementById("editCountry");
    var stateInput = document.getElementById("editState");
    var zipCodeInput = document.getElementById("editZipCode");
    // var useForBillingCheckbox = document.getElementById("editSameAddress"); // Add this line to declare useForBillingCheckbox variable

    const formData = {
      email: emailInput.value,
      firstName: firstNameInput.value,
      lastName: lastNameInput.value,
      address: addressInput.value,
      phoneNumber: phoneNumberInput.value,
      country: countryInput.value,
      state: stateInput.value,
      zipCode: zipCodeInput.value,
      // useForBilling: useForBillingCheckbox.checked,
    };

    fetch(`/submit-address/${addressId}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(formData),
    })
      .then((response) => {
        return response.json();
      })
      .then((data) => {
        console.log(data);
        window.location.reload();
        modal.style.display = "none";
      })
      .catch((error) => {
        console.error(error);
      });
  }

  document.addEventListener("DOMContentLoaded", function () {
    var submitBtn = document.getElementById("submitAddressButton");
    submitBtn.addEventListener("click", function () {
      var addressId = submitBtn.getAttribute("data-address-id");
      editAddress(addressId);
    });
  });
</script>

<script></script>
