<style>
  .align-middle {
    color: black;
    vertical-align: middle !important;
  }

  .card {
    margin-bottom: 2vh !important;
  }
  .card-text-small {
    font-size: 14px;
  }

  .card {
    margin-bottom: 10vh;
  }

  .card-text-bold {
    font-weight: bold;
  }

  .justify-content-end {
    margin-bottom: 2rem;
    margin-right: 2rem;
  }

  .form-control {
    display: block;
    width: 100%;
    height: calc(1.5em + 0.75rem + 2px);
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
  }

  /* The Modal */
  .modal {
    display: none; /* Hide the modal by default */
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(
      0,
      0,
      0,
      0.8
    ); /* Create a semi-transparent background overlay */
  }

  /* Modal Content */
  .modal-content {
    background-color: #fefefe;
    padding: 20px;
    width: 100%;
    position: relative;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
    border-radius: 1rem;
    margin: 0 auto;
  }

  /* Close Button */

  /* Blur the background */
  body.modal-open {
    overflow: hidden; /* Prevent scrolling on the background */
  }

  .modal-open .modal {
    overflow: auto;
  }

  .modal-open .modal-content {
    margin-top: 20vh;
  }
</style>
<section class="mt-5 container">
  <!-- Page Content Goes Here -->

  <h1 class="mb-4 display-5 fw-bold text-center">Checkout Securely</h1>
  <p class="text-center mx-auto">
    Please fill in the details below to complete your order. Already registered?
    <a href="#">Login here.</a>
  </p>

  <div class="row">
    <!-- Select Address -->
    <div class="col-lg-7">
      <!-- Add New Address card -->
      <div class="card mt-4">
        <div class="card-body">
          <h5 class="card-title">Add New Address</h5>
          <p class="card-text">Click here to add a new address.</p>
          <a id="addNewAddress" class="btn btn-primary">Add New Address</a>
        </div>
      </div>
      <!-- /Add New Address card -->
      <h5 class="card-title">Select Address</h5>
      <% addresses.forEach(address => { %>
      <!-- address card -->
      <div class="card" id="address-card">
        <div class="card-body">
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="card-selection"
              id="card2"
              onchange="toggleEditRemoveButtons(this)"
            />
            <label class="form-check-label" for="card2">
              <h5 class="card-title">
                <%= address.fname %> <%= address.lname %>
              </h5>
            </label>
          </div>
          <p class="card-text card-text-small">
            <%= address.address %> , <%= address.state %> , <%= address.country
            %>
          </p>
          <p class="card-text card-text-small">Email :<%= address.email %></p>
          <p class="card-text card-text-small">
            Mobile: <%= address.phoneNumber %>
          </p>
          <p class="card-text card-text-small"><%= address.zipcode %></p>
          <br />
          <p class="card-text card-text-small">â€¢ Pay on Delivery available</p>
          <div style="margin-bottom: 0%" class="d-flex justify-content-end">
            <button
              class="btn btn-primary me-2"
              id="edit-button"
              style="display: none"
            >
              Edit
            </button>
            <button
              class="btn btn-danger"
              id="remove-button"
              style="display: none"
            >
              Remove
            </button>
          </div>
        </div>
      </div>
      <!-- /address card -->
      <% }); %>

      <!-- The Modal -->
      <div id="myModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content" style="border-radius: 1rem">
            <div>
              <button
                type="button"
                class="btn-close"
                data-dismiss="modal"
                aria-label="Close"
              >
                &times;
              </button>
            </div>
            <div class="modal-body pt-0">
              <h5 class="title-checkout">Shipping Address</h5>
              <form method="post" action="/add-address" id="addressForm">
                <div class="form-group col-12">
                  <label for="email" class="form-label">Email</label>
                  <input
                    type="text"
                    class="form-control"
                    id="Email"
                    placeholder="you@example.com"
                    required=""
                  />
                </div>
                <div class="form-group col-12">
                  <label for="phoneNumber" class="form-label"
                    >Mobile Number</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="phoneNumber"
                    required=""
                  />
                </div>
                <div class="form-group d-flex">
                  <!-- First name -->
                  <div class="col-sm-6">
                    <div class="form-group">
                      <label for="firstName" class="form-label"
                        >First name</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="firstName"
                        placeholder=""
                        value=""
                        required=""
                      />
                    </div>
                  </div>
                  <!-- Last Name-->
                  <div class="col-sm-6">
                    <div class="form-group">
                      <label for="lastName" class="form-label">Last name</label>
                      <input
                        type="text"
                        class="form-control"
                        id="lastName"
                        placeholder=""
                        value=""
                        required=""
                      />
                    </div>
                  </div>
                </div>
                <div class="form-group col-12">
                  <label for="address" class="form-label">Address</label>
                  <input
                    type="text"
                    class="form-control"
                    id="address"
                    placeholder="123 Some Street Somewhere"
                    required=""
                  />
                </div>

                <div class="form-group col-12">
                  <label for="address" class="form-label">Country</label>
                  <select class="form-control" id="country" required="">
                    <option value="">Please Select...</option>
                    <option>India</option>
                    <option>United States</option>
                  </select>
                </div>
                <div class="d-flex">
                  <div class="form-group col-6">
                    <label for="address" class="form-label">State</label>
                    <select class="form-control" id="state" required="">
                      <option value="">Please Select...</option>
                      <option>Goa</option>
                      <option>Gujarat</option>
                      <option>Karnataka</option>
                      <option>Kerala</option>
                      <option>Tamil Nadu</option>
                    </select>
                  </div>

                  <div class="form-group col-6">
                    <label for="address" class="form-label"
                      >Zip / Post Code</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="zipCode"
                      required=""
                    />
                  </div>
                </div>
                <div class="form-group col-12">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    id="same-address"
                    checked
                  />
                  <label class="form-check-label" for="same-address"
                    >Use for billing address</label
                  >
                </div>
                <button type="submit" class="btn btn-success">Submit</button>
              </form>
            </div>
            <div class="modal-footer"></div>
          </div>
        </div>
      </div>
    </div>
    <!-- / Select Address -->

    <!-- Checkout Panel Summary -->
    <div class="col-lg-5">
      <div class="bg-light p-4 sticky-md-top top-5">
        <div class="border-bottom pb-3">
          <!-- Cart Item-->
          <% products.forEach((item) => { %>
          <div
            class="d-none d-md-flex justify-content-between align-items-start py-2"
          >
            <div
              class="d-flex flex-grow-1 justify-content-start align-items-start"
            >
              <div class="position-relative f-w-20 border p-2 me-4">
                <span class="checkout-item-qty">1</span>
                <img
                  src="/<%= item.image %>"
                  alt=""
                  class="rounded img-fluid"
                />
              </div>

              <div>
                <p class="mb-1 fs-6 fw-bolder"><%= item.name %></p>
                <small class="d-block text-muted">Mens / Blue / Medium</small>
                <span class="fs-xs text-uppercase fw-bolder text-muted"></span>
              </div>
            </div>
            <div class="flex-shrink-0 fw-bolder">
              <span>$<%= item.price %></span>
            </div>
          </div>

          <!-- / Cart Item-->
          <% }); %>
        </div>
        <div class="py-3 border-bottom">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <p class="m-0 fw-bolder fs-6">Subtotal</p>
            <p class="m-0 fs-6 fw-bolder">$<%= subtotal %></p>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <p class="m-0 fw-bolder fs-6">Shipping</p>
            <p class="m-0 fs-6 fw-bolder">$8.95</p>
          </div>
        </div>
        <div class="py-3 border-bottom">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <p class="m-0 fw-bold fs-5">Grand Total</p>
              <span class="text-muted small">Inc $45.89 sales tax</span>
            </div>
            <p class="m-0 fs-5 fw-bold">$<%= grandTotal %></p>
          </div>
        </div>
        <div class="py-3 border-bottom">
          <div class="input-group mb-0">
            <input
              type="text"
              class="form-control"
              placeholder="Enter your coupon code"
            />
            <button class="btn btn-dark btn-sm px-4">Apply</button>
          </div>
        </div>
        <!-- Accept Terms Checkbox-->
        <div class="form-group form-check my-4">
          <input
            type="checkbox"
            class="form-check-input"
            id="accept-terms"
            checked
          />
          <label class="form-check-label fw-bolder" for="accept-terms"
            >I agree to Alpine's <a href="#">terms & conditions</a></label
          >
        </div>
        <a href="#" class="btn btn-dark w-100" role="button">Complete Order</a>
      </div>
    </div>
    <!-- / Checkout Panel Summary -->
  </div>

  <!-- /Page Content -->
</section>

<script>
  function toggleEditRemoveButtons(radioButton) {
    const editButton = document.getElementById("edit-button");
    const removeButton = document.getElementById("remove-button");

    if (radioButton.checked) {
      editButton.style.display = "block";
      removeButton.style.display = "block";
    } else {
      editButton.style.display = "none";
      removeButton.style.display = "none";
    }
  }
</script>

<script>
  // Get the modal element
  var modal = document.getElementById("myModal");

  // Get the button that opens the modal
  var btn = document.getElementById("addNewAddress");

  // Get the close button
  var closeBtn = document.getElementsByClassName("btn-close")[0];

  // Open the modal when the button is clicked
  btn.addEventListener("click", function () {
    modal.style.display = "block";
  });

  // Close the modal when the close button is clicked
  closeBtn.addEventListener("click", function () {
    modal.style.display = "none";
  });

  // Close the modal when the user clicks outside of it
  window.addEventListener("click", function (event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  });

  // Submit the form data
  document
    .getElementById("addressForm")
    .addEventListener("submit", function (event) {
      event.preventDefault();

      // Get the form input values
      const email = document.getElementById("Email").value;
      const firstName = document.getElementById("firstName").value;
      const lastName = document.getElementById("lastName").value;
      const address = document.getElementById("address").value;
      const phoneNumber = document.getElementById("phoneNumber").value;
      const country = document.getElementById("country").value;
      const state = document.getElementById("state").value;
      const zipCode = document.getElementById("zipCode").value;
      const useForBilling = document.getElementById("same-address").checked;

      // Construct the address object
      const addressData = {
        email,
        firstName,
        lastName,
        address,
        country,
        state,
        phoneNumber,
        zipCode,
        useForBilling,
      };

      // Make a fetch request to the "/add-address" URL
      fetch("/add-address", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(addressData),
      })
        .then((response) => response.json())
        .then((data) => {
          // Handle the response data
          console.log(data);
          // Close the modal after successful submission if desired
          modal.style.display = "none";
        })
        .catch((error) => {
          // Handle any errors
          console.error(error);
        });
    });
</script>
